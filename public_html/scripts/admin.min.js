function saveUsertoDatabase(e){firebase.database().ref("users/"+e.uid).set(e).then(function(){console.log("Synchronization succeeded")}).catch(function(){console.log("Synchronization failed")})}function updateProfile(e,o){const t=firebase.auth().currentUser;return t?(progress(!0),void t.updateProfile({displayName:e,photoURL:o}).then(function(){progress(!1),show(toastr.success("Profile updated successfully!"))},function(e){progress(!1),showError(e)})):void showError("You're logged out!")}function changeProfilePic(e){progress(!0),avatar.src=null==e||"null"==e||""==e?"https://res.cloudinary.com/amuroboclub/image/upload/person.svg":e}function loadProfileSettings(e,o,t){changeProfilePic(o),$(avatar).load(function(){progress(!1)});const n=document.getElementById("inputName"),i=document.getElementById("select");option=document.createElement("option"),option.value=o,option.text="Default Photo (Current)",i.options.add(option),t.forEach(function(e){option=document.createElement("option"),option.value=e.photoURL,option.text=e.providerId,i.options.add(option)}),i.onchange=function(){changeProfilePic(this.value)},n.value=e,document.getElementById("profile-form").onsubmit=function(){return updateProfile(n.value,i.options.item(i.options.selectedIndex).value),!1}}function loadEditNews(e){const o=document.getElementById("edit-form"),t=document.getElementById("update-news"),n=document.getElementById("delete-news"),i=$("#newsKey"),s=$("#edit-message");i.val(e),t.onclick=function(){pushNewsToDatabase(s.val(),e)},n.onclick=function(){progress(!0),firebase.database().ref(newsRef+e).remove().then(function(){progress(!1),show(toastr.success("Announcement Deleted")),toggleVisibility(!1,o)}).catch(function(e){progress(!1),showError(e)})},firebase.database().ref(newsRef+e).once("value").then(function(e){s.val(e.val().notice),toggleVisibility(!0,o)}).catch(function(e){console.log(e)})}function pushNewsToDatabase(e,o){return progress(!0),o?void firebase.database().ref(newsRef+o).update({notice:e}).then(function(){progress(!1),show(toastr.success("Message successfully updated!"))}):void firebase.database().ref(newsRef).push(e).then(function(e){progress(!1),show(toastr.success("News posted successfully"));try{loadEditNews(e.key)}catch(o){console.log(o)}}).catch(function(e){progress(!1),showError("An error occurred! \n"+e+"\n You do not have permission to send notiifcatons")})}function requestFCM(e,o){const t={title:e,message:o};progress(!0);const n=function(e){progress(!1),e.error?showError(e.message):show(toastr.success("Notification "+e.message+" Message ID : "+e.message_id))},i=function(e,o,t){progress(!1),showError("Error "+t)};firebase.auth().currentUser.getToken().then(function(e){request("POST","./send_notification",{Authorization:"Bearer "+e},t,n,i)}).catch(function(e){progress(!1),showError(e)})}function sendNotification(e,o,t){if(null==e||null==o)return void showError("Can't send empty message");if(e.length<4||o.length<5)return void showError("Title or Message is too small");const n=$.format.date((new Date).getTime(),"ddd, D MMMM yyyy");var i={notice:o,date:n,timestamp:-Math.floor(Date.now()/1e3)};null!=t&&t.length>5&&(i.link=t),completed=!1;var s=$("input[name='sendOptions']:checked").val();switch(s){case"news":pushNewsToDatabase(i);break;case"notification":requestFCM(e,o);break;default:pushNewsToDatabase(i),requestFCM(e,o)}}function initializeNotificationPanel(e){const o=document.getElementById("notification"),t=document.getElementById("tab-notification"),n=document.getElementById("edit-form");toggleVisibilities(!1,[o,t,n]),progress(!0);const i="/admins/"+e;firebase.database().ref(i).once("value").then(function(e){e.val()&&toggleVisibilities(!0,[o,t]),progress(!1)});const s=document.getElementById("title"),a=document.getElementById("message"),r=document.getElementById("link");document.getElementById("notification-form").onsubmit=function(){return sendNotification(s.value,a.value,r.value),!1},document.getElementById("update-news").onclick=function(){showError("No message to edit")}}function populateOptions(e){loadProfileSettings(e.displayName,e.photoURL,e.providerData),initializeNotificationPanel(e.uid)}function initApp(){const e=document.getElementById("sign-in"),o=document.getElementById("welcome"),t=document.getElementById("account-detail");progress(!0),loadingAnimation(!0),firebase.auth().onAuthStateChanged(function(n){if(progress(!1),loadingAnimation(!1),n){const i=(document.getElementById("avatar"),{name:n.displayName,email:n.email,emailVerified:n.emailVerified,photoURL:n.photoURL,uid:n.uid,providerData:n.providerData});saveUsertoDatabase(i),o.innerHTML="Welcome, <strong>"+i.name+"</strong>",e.textContent="Sign out",e.onclick=signOut,toggleVisibility(!0,t),populateOptions(n)}else e.textContent="Sign in",o.textContent="You're signed out!",e.onclick=function(){location.href="./signin"},toggleVisibility(!1,t)},showError)}const newsRef="news/";window.addEventListener("load",function(){initApp()});