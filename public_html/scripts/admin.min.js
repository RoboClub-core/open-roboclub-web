function saveUsertoDatabase(e){firebase.database().ref("users/"+e.uid).set(e).then(function(){console.log("Synchronization succeeded")}).catch(function(){console.log("Synchronization failed")})}function updateProfile(e,t){const o=firebase.auth().currentUser;return o?(progress(!0),void o.updateProfile({displayName:e,photoURL:t}).then(function(){progress(!1),show(toastr.success("Profile updated successfully!"))},function(e){progress(!1),showError(e)})):void showError("You're logged out!")}function changeProfilePic(e){progress(!0),avatar.src=null==e||"null"==e||""==e?"https://res.cloudinary.com/amuroboclub/image/upload/person.svg":e}function loadProfileSettings(e,t,o){changeProfilePic(t),$(avatar).load(function(){progress(!1)});const n=document.getElementById("inputName"),i=document.getElementById("select");option=document.createElement("option"),option.value=t,option.text="Default Photo (Current)",i.options.add(option),o.forEach(function(e){option=document.createElement("option"),option.value=e.photoURL,option.text=e.providerId,i.options.add(option)}),i.onchange=function(){changeProfilePic(this.value)},n.value=e,document.getElementById("profile-form").onsubmit=function(){return updateProfile(n.value,i.options.item(i.options.selectedIndex).value),!1}}function pushNewsToDatabase(e){progress(!0),firebase.database().ref("news/").push(e).then(function(){progress(!1),show(toastr.success("News posted successfully"))}).catch(function(e){progress(!1),showError("An error occurred! \n"+e+"\n You do not have permission to send notiifcatons")})}function requestFCM(e,t){const o={title:e,message:t};progress(!0);const n=function(e){progress(!1),e.error?showError(e.message):show(toastr.success('Notification '+e.message+" Message ID : "+e.message_id))},i=function(e,t,o){progress(!1),showError("Error "+o)};firebase.auth().currentUser.getToken().then(function(e){request("POST","./send_notification",{Authorization:"Bearer "+e},o,n,i)}).catch(function(e){progress(!1),showError(e)})}function sendNotification(e,t,o){if(null==e||null==t)return void showError("Can't send empty message");if(e.length<4||t.length<5)return void showError("Title or Message is too small");const n=new Date;var i={notice:t,date:n.toDateString()};null!=o&&o.length>5&&(i.link=o),completed=!1;var s=$("input[name='sendOptions']:checked").val();switch(s){case"news":pushNewsToDatabase(i);break;case"notification":requestFCM(e,t);break;default:pushNewsToDatabase(i),requestFCM(e,t)}}function initializeNotificationPanel(e){const t=document.getElementById("notification"),o=document.getElementById("tab-notification");toggleVisibilities(!1,[t,o]),progress(!0);const n="/admins/"+e;firebase.database().ref(n).once("value").then(function(e){e.val()&&toggleVisibilities(!0,[t,o]),progress(!1)});const i=document.getElementById("title"),s=document.getElementById("message"),r=document.getElementById("link");document.getElementById("notification-form").onsubmit=function(){return sendNotification(i.value,s.value,r.value),!1}}function populateOptions(e){loadProfileSettings(e.displayName,e.photoURL,e.providerData),initializeNotificationPanel(e.uid)}function initApp(){const e=document.getElementById("sign-in"),t=document.getElementById("welcome"),o=document.getElementById("account-detail");progress(!0),firebase.auth().onAuthStateChanged(function(n){if(progress(!1),n){const i=(document.getElementById("avatar"),{name:n.displayName,email:n.email,emailVerified:n.emailVerified,photoURL:n.photoURL,uid:n.uid,providerData:n.providerData});saveUsertoDatabase(i),t.innerHTML="Welcome, <strong>"+i.name+"</strong>",e.textContent="Sign out",e.onclick=signOut,toggleVisibility(!0,o),populateOptions(n)}else e.textContent="Sign in",t.textContent="You're signed out!",e.onclick=function(){location.href="./signin"},toggleVisibility(!1,o)},showError)}window.addEventListener("load",function(){initApp()});