function saveUsertoDatabase(e){firebase.database().ref("users/"+e.uid).set(e).then(function(){console.log("Synchronization succeeded")}).catch(function(){console.log("Synchronization failed")})}function updateProfile(e,t){const o=firebase.auth().currentUser;return o?(progress(!0),void o.updateProfile({displayName:e,photoURL:t}).then(function(){progress(!1),show(toastr.success("Profile updated successfully!"))},function(e){progress(!1),showError(e)})):void showError("You're logged out!")}function changeProfilePic(e){progress(!0),avatar.src=null==e||"null"==e||""==e?"https://res.cloudinary.com/amuroboclub/image/upload/person.svg":e}function loadProfileSettings(e,t,o){changeProfilePic(t),$(avatar).load(function(){progress(!1)});const n=document.getElementById("inputName"),s=document.getElementById("select");option=document.createElement("option"),option.value=t,option.text="Default Photo (Current)",s.options.add(option),o.forEach(function(e){option=document.createElement("option"),option.value=e.photoURL,option.text=e.providerId,s.options.add(option)}),s.onchange=function(){changeProfilePic(this.value)},n.value=e,document.getElementById("profile-form").onsubmit=function(){return updateProfile(n.value,s.options.item(s.options.selectedIndex).value),!1}}function loadEditNews(e){const t=document.getElementById("edit-form"),o=document.getElementById("update-news"),n=document.getElementById("delete-news"),s=$("#newsKey"),i=$("#edit-message");s.val(e),o.onclick=function(){pushNewsToDatabase(i.val(),e)},n.onclick=function(){progress(!0),firebase.database().ref(newsRef+e).remove().then(function(){progress(!1),show(toastr.success("Announcement Deleted")),toggleVisibility(!1,t)}).catch(function(e){progress(!1),showError(e)})},firebase.database().ref(newsRef+e).once("value").then(function(e){i.val(e.val().notice),toggleVisibility(!0,t)}).catch(function(e){console.log(e)})}function pushNewsToDatabase(e,t){return progress(!0),t?void firebase.database().ref(newsRef+t).update({notice:e}).then(function(){progress(!1),show(toastr.success("Message successfully updated!"))}):void firebase.database().ref(newsRef).push(e).then(function(e){progress(!1),show(toastr.success("News posted successfully"));try{loadEditNews(e.key)}catch(t){console.log(t)}}).catch(function(e){progress(!1),showError("An error occurred! \n"+e+"\n You do not have permission to send notiifcatons")})}function requestFCM(e,t){const o={title:e,message:t};progress(!0);const n=function(e){progress(!1),e.error?showError(e.message):show(toastr.success("Notification "+e.message+" Message ID : "+e.message_id))},s=function(e,t,o){progress(!1),showError("Error "+o)};firebase.auth().currentUser.getToken().then(function(e){request("POST","./send_notification",{Authorization:"Bearer "+e},o,n,s)}).catch(function(e){progress(!1),showError(e)})}function sendNotification(e,t,o){if(null==e||null==t)return void showError("Can't send empty message");if(e.length<4||t.length<5)return void showError("Title or Message is too small");const n=$.format.date((new Date).getTime(),"ddd, D MMMM yyyy");var s={notice:t,date:n,timestamp:-Math.floor(Date.now()/1e3)};null!=o&&o.length>5&&(s.link=o),completed=!1;var i=$("input[name='sendOptions']:checked").val();switch(i){case"news":pushNewsToDatabase(s);break;case"notification":requestFCM(e,t);break;default:pushNewsToDatabase(s),requestFCM(e,t)}}function initializeNotificationPanel(e){const t=document.getElementById("notification"),o=document.getElementById("tab-notification"),n=document.getElementById("edit-form");toggleVisibilities(!1,[t,o,n]),progress(!0);const s="/admins/"+e;firebase.database().ref(s).once("value").then(function(e){e.val()&&toggleVisibilities(!0,[t,o]),progress(!1)});const i=document.getElementById("title"),a=document.getElementById("message"),r=document.getElementById("link");document.getElementById("notification-form").onsubmit=function(){return sendNotification(i.value,a.value,r.value),!1},document.getElementById("update-news").onclick=function(){showError("No message to edit")}}function populateOptions(e){loadProfileSettings(e.displayName,e.photoURL,e.providerData),initializeNotificationPanel(e.uid)}function initApp(){const e=document.getElementById("sign-in"),t=document.getElementById("welcome"),o=document.getElementById("account-detail");progress(!0),firebase.auth().onAuthStateChanged(function(n){if(progress(!1),n){const s=(document.getElementById("avatar"),{name:n.displayName,email:n.email,emailVerified:n.emailVerified,photoURL:n.photoURL,uid:n.uid,providerData:n.providerData});saveUsertoDatabase(s),t.innerHTML="Welcome, <strong>"+s.name+"</strong>",e.textContent="Sign out",e.onclick=signOut,toggleVisibility(!0,o),populateOptions(n)}else e.textContent="Sign in",t.textContent="You're signed out!",e.onclick=function(){location.href="./signin"},toggleVisibility(!1,o)},showError)}const newsRef="news/";window.addEventListener("load",function(){initApp()});