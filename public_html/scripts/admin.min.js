function saveUsertoDatabase(a){firebase.database().ref("users/"+a.uid).set(a).then(function(){console.log("Synchronization succeeded")})["catch"](function(a){console.log("Synchronization failed")})}function updateProfile(a,b){var d=firebase.auth().currentUser;d?(progress(!0),d.updateProfile({displayName:a,photoURL:b}).then(function(){progress(!1);show(toastr.success("Profile updated successfully!"))},function(a){progress(!1);showError(a)})):showError("You're logged out!")}
function changeProfilePic(a){progress(!0);avatar.src=null==a||"null"==a||""==a?"https://res.cloudinary.com/amuroboclub/image/upload/person.svg":a}completed=!1;
function loadProfileSettings(a,b,d){changeProfilePic(b);$(avatar).load(function(){progress(!1)});var c=document.getElementById("inputName"),e=document.getElementById("select");option=document.createElement("option");option.value=b;option.text="Default Photo (Current)";e.options.add(option);d.forEach(function(a){option=document.createElement("option");option.value=a.photoURL;option.text=a.providerId;e.options.add(option)});e.onchange=function(){changeProfilePic(this.value)};c.value=a;document.getElementById("profile-form").onsubmit=
function(){updateProfile(c.value,e.options.item(e.options.selectedIndex).value);return!1}}function pushNewsToDatabase(a){progress(!0);firebase.database().ref("news/").push(a).then(function(){completed&&progress(!1);show(toastr.success("News posted successfully"))})["catch"](function(a){completed&&progress(!1);showError("An error occurred! \n"+a+"\n You do not have permission to send notiifcatons")})}
function requestFCM(a,b){var d={title:a,message:b};progress(!0);firebase.auth().currentUser.getToken().then(function(a){$.ajax({type:"POST",url:"./send_notification",headers:{Authorization:"Bearer "+a},crossDomain:!1,data:d,dataType:"json",success:function(a,c,b){completed=!0;progress(!1);a.error?showError(a.message):show(toastr.success(a.message+"\nMessage ID : "+a.message_id))},error:function(a,c,b){completed=!0;progress(!1);showError("Error "+b)}})})["catch"](function(a){completed=!0;progress(!1);
showError(a)})}function sendNotification(a,b,d){if(null==a||null==b)showError("Can't send empty message");else if(4>a.length||5>b.length)showError("Title or Message is too small");else{var c={notice:b,date:(new Date).toDateString()};null!=d&&5<d.length&&(c.link=d);completed=!1;pushNewsToDatabase(c);requestFCM(a,b)}}
function initializeNotificationPanel(a){var b=document.getElementById("notification"),d=document.getElementById("tab-notification");toggleVisibilities(!1,[b,d]);progress(!0);a="/admins/"+a;firebase.database().ref(a).once("value").then(function(a){a.val()&&toggleVisibilities(!0,[b,d]);progress(!1)});var c=document.getElementById("title"),e=document.getElementById("message"),f=document.getElementById("link");document.getElementById("notification-form").onsubmit=function(){sendNotification(c.value,e.value,
f.value);return!1}}function populateOptions(a){loadProfileSettings(a.displayName,a.photoURL,a.providerData);initializeNotificationPanel(a.uid)}
function initApp(){var a=document.getElementById("sign-in"),b=document.getElementById("welcome"),d=document.getElementById("account-detail");progress(!0);firebase.auth().onAuthStateChanged(function(c){progress(!1);if(c){document.getElementById("avatar");var e={name:c.displayName,email:c.email,emailVerified:c.emailVerified,photoURL:c.photoURL,uid:c.uid,providerData:c.providerData};saveUsertoDatabase(e);b.innerHTML="Welcome, <strong>"+e.name+"</strong>";a.textContent="Sign out";a.onclick=signOut;toggleVisibility(!0,
d);populateOptions(c)}else a.textContent="Sign in",b.textContent="You're signed out!",a.onclick=function(){location.href="./signin"},toggleVisibility(!1,d)},showError)}window.addEventListener("load",function(){initApp()});