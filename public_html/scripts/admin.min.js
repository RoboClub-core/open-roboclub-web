function saveUsertoDatabase(a){firebase.database().ref("users/"+a.uid).set(a).then(function(){console.log("Synchronization succeeded")})["catch"](function(a){console.log("Synchronization failed")})}function updateProfile(a,b){var d=firebase.auth().currentUser;d?(progress(!0),d.updateProfile({displayName:a,photoURL:b}).then(function(){progress(!1);show(toastr.success("Profile updated successfully!"))},function(a){progress(!1);show(toastr.error(a))})):show(toastr.error("You're logged out!"))}
function changeProfilePic(a){progress(!0);avatar.src=null==a||"null"==a||""==a?"https://res.cloudinary.com/amuroboclub/image/upload/person.svg":a}
function loadProfileSettings(a,b,d){changeProfilePic(b);$(avatar).load(function(){progress(!1)});var c=document.getElementById("inputName"),e=document.getElementById("select");option=document.createElement("option");option.value=b;option.text="Default Photo (Current)";e.options.add(option);d.forEach(function(a){option=document.createElement("option");option.value=a.photoURL;option.text=a.providerId;e.options.add(option)});e.onchange=function(){changeProfilePic(this.value)};c.value=a;document.getElementById("profile-form").onsubmit=
function(){updateProfile(c.value,e.options.item(e.options.selectedIndex).value);return!1}}completed=!1;function pushNewsToDatabase(a){progress(!0);firebase.database().ref("news/").push(a).then(function(){completed&&progress(!1);show(toastr.success("News posted successfully"))})["catch"](function(a){completed&&progress(!1);show(toastr.error("An error occurred! \n"+a+"\n You do not have permission to send notiifcatons"))})}
function requestFCM(a,b){var d={title:a,message:b};progress(!0);firebase.auth().currentUser.getToken().then(function(a){$.ajax({type:"POST",url:"./send_notification",headers:{Authorization:"Bearer "+a},crossDomain:!1,data:d,dataType:"json",success:function(a,c,b){completed=!0;progress(!1);a.error?show(toastr.error(a.message)):show(toastr.success(a.message+"\nMessage ID : "+a.message_id))},error:function(a,c,b){completed=!0;progress(!1);show(toastr.error("Error "+b))}})})["catch"](function(a){completed=
!0;progress(!1);show(toastr.error(a))})}function sendNotification(a,b,d){if(null==a||null==b)show(toastr.error("Can't send empty message"));else if(4>a.length||5>b.length)show(toastr.error("Title or Message is too small"));else{var c={notice:b,date:(new Date).toDateString()};null!=d&&5<d.length&&(c.link=d);completed=!1;pushNewsToDatabase(c);requestFCM(a,b)}}
function initializeNotificationPanel(){var a=document.getElementById("title"),b=document.getElementById("message"),d=document.getElementById("link");document.getElementById("notification-form").onsubmit=function(){sendNotification(a.value,b.value,d.value);return!1}}function populateOptions(a){loadProfileSettings(a.displayName,a.photoURL,a.providerData);initializeNotificationPanel()}
function initApp(){var a=document.getElementById("sign-in"),b=document.getElementById("welcome"),d=document.getElementById("account-detail");progress(!0);firebase.auth().onAuthStateChanged(function(c){progress(!1);if(c){document.getElementById("avatar");var e={name:c.displayName,email:c.email,emailVerified:c.emailVerified,photoURL:c.photoURL,uid:c.uid,providerData:c.providerData};saveUsertoDatabase(e);b.innerHTML="Welcome, <strong>"+e.name+"</strong>";a.textContent="Sign out";a.onclick=function(){firebase.auth().signOut()};
toggleVisibility(!0,d);populateOptions(c)}else a.textContent="Sign in",b.textContent="You're signed out!",a.onclick=function(){location.href="./signin"},toggleVisibility(!1,d)},function(a){show(toastr.error(a))})}window.addEventListener("load",function(){initApp()});